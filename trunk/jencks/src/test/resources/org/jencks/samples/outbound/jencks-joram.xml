<?xml version="1.0" encoding="ISO-8859-1"?>

<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

  <!--

         ###### Transaction manager ######

   -->


  <bean id="connectionTracker"
        class="org.apache.geronimo.connector.outbound.connectiontracking.ConnectionTrackingCoordinator"/>

  <bean id="transactionManagerImpl" class="org.jencks.factory.TransactionManagerFactoryBean">
    <property name="defaultTransactionTimeoutSeconds">
      <value>600</value>
    </property>
    <property name="transactionLog">
      <bean class="org.apache.geronimo.transaction.log.UnrecoverableLog"/>
    </property>
  </bean>

  <bean id="transactionContextManager" class="org.jencks.factory.TransactionContextManagerFactoryBean">
    <property name="transactionManagerImpl">
      <ref local="transactionManagerImpl"/>
    </property>
  </bean>

  <bean id="userTransaction" class="org.jencks.factory.UserTransactionFactoryBean">
    <property name="transactionContextManager">
      <ref local="transactionContextManager"/>
    </property>
    <property name="connectionTrackingCoordinator">
      <ref local="connectionTracker"/>
    </property>
  </bean>

  <bean id="transactionManager" class="org.springframework.transaction.jta.JtaTransactionManager">
    <property name="userTransaction">
      <ref local="userTransaction"/>
    </property>
    <property name="transactionManager">
      <ref local="transactionManagerImpl"/>
    </property>
  </bean>

  <bean id="transactionContextInitializer" class="org.jencks.interceptor.TransactionContextInitializer">
    <property name="associator">
      <ref local="connectionTracker"/>
    </property>
  </bean>

  <!--

         ###### JCA ######

   -->

  <bean id="transactionSupport"
        class="org.jencks.factory.XATransactionFactoryBean">
    <property name="useTransactionCaching">
      <value>true</value>
    </property>
    <property name="useThreadCaching">
      <value>false</value>
    </property>
  </bean>

  <bean id="poolingSupport" class="org.jencks.factory.SinglePoolFactoryBean">
    <property name="maxSize">
      <value>2</value>
    </property>
    <property name="minSize">
      <value>1</value>
    </property>
    <property name="blockingTimeoutMilliseconds">
      <value>60</value>
    </property>
    <property name="idleTimeoutMinutes">
      <value>60</value>
    </property>
    <property name="matchOne">
      <value>true</value>
    </property>
    <property name="matchAll">
      <value>true</value>
    </property>
    <property name="selectOneAssumeMatch">
      <value>true</value>
    </property>
  </bean>

  <bean id="connectionManager" class="org.jencks.factory.ConnectionManagerFactoryBean">
    <property name="transactionSupport">
      <ref local="transactionSupport"/>
    </property>
    <property name="poolingSupport">
      <ref local="poolingSupport"/>
    </property>
    <property name="transactionContextManager">
      <ref local="transactionContextManager"/>
    </property>
    <property name="connectionTracker">
      <ref local="connectionTracker"/>
    </property>
  </bean>

  <!--

         ###### JMS ######

   -->

  <bean class="org.jencks.samples.outbound.JoramLauncher"/>

  <bean id="jmsResourceAdapter" class="org.objectweb.joram.client.connector.JoramAdapter"/>

  <bean id="jmsManagedConnectionFactory" class="org.objectweb.joram.client.connector.ManagedConnectionFactoryImpl">
    <property name="hostName"><value>localhost</value></property>
    <property name="serverPort"><value>16010</value></property>
    <property name="userName"><value>root</value></property>
    <property name="password"><value>root</value></property>
	<property name="resourceAdapter"><ref local="jmsResourceAdapter"/></property>
  </bean>

  <bean id="jmsConnectionFactory" class="org.springframework.jca.support.LocalConnectionFactoryBean">
    <property name="managedConnectionFactory"><ref local="jmsManagedConnectionFactory"/></property>
    <property name="connectionManager"><ref local="connectionManager"/></property>
  </bean>

  <bean id="jmsQueue" class="org.springframework.jndi.JndiObjectFactoryBean" depends-on="jmsResourceAdapter"> 
    <property name="jndiName"><value>queue</value></property> 
    <property name="jndiEnvironment">
      <props>
        <prop key="java.naming.factory.initial">fr.dyade.aaa.jndi2.client.NamingContextFactory</prop>
        <prop key="java.naming.provider.url">scn://localhost:16400</prop>
        </props>
    </property>
  </bean> 

</beans>