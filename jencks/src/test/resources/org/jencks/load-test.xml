<?xml version="1.0" encoding="ISO-8859-1"?>
<beans xmlns:jencks="http://jencks.org/2.0" xmlns:amq="http://activemq.org/config/1.0"
  xmlns:amqra="http://activemq.org/ra/1.0">

  <!-- Transaction manager -->
  <jencks:transactionManager id="transactionManager" transactionLogDir="./target/data/txlog"
    defaultTransactionTimeoutSeconds="600" />

  <!-- Work manager -->
  <jencks:workManager id="workManager" threadPoolSize="10" transactionManager="#transactionManager" />

  <!-- Bootstrap context for JCA -->
  <jencks:bootstrapContext id="bootstrapContext" workManager="#workManager"
    transactionManager="#transactionManager" />

  <!-- Connection manager for JCA -->
  <jencks:connectionTracker id="connectionTracker" geronimoTransactionManager="#transactionManager" />

  <jencks:poolingSupport id="poolingSupport" />

  <jencks:connectionManager id="connectionManager" containerManagedSecurity="false" transaction="xa"
    transactionManager="#transactionManager" poolingSupport="#poolingSupport"
    connectionTracker="#connectionTracker" />

  <!-- JCA Container -->
  <jencks:jcaContainer id="jca" bootstrapContext="#bootstrapContext" resourceAdapter="#resourceAdapter" />
  
  <!--
    <jencks:connector ref="sender" jcaContainer="#jca">
    <jencks:activationSpec>
      <amqra:activationSpec destination="test.in" destinationType="javax.jms.Queue" />
    </jencks:activationSpec>
  </jencks:connector>
  -->
  
  <bean id="sender" class="org.jencks.LoadTest$Sender">
    <property name="connectionFactory" ref="managedConnectionFactory" />
  </bean>
  
  <amqra:managedConnectionFactory id="activemqMcf" resourceAdapter="#resourceAdapter" />
  <amqra:resourceAdapter id="resourceAdapter" serverUrl="tcp://localhost:61616" />
  <jencks:connectionFactory id="managedConnectionFactory" managedConnectionFactory="#activemqMcf"
    connectionManager="#connectionManager" />

  <bean id="pooledConnectionFactory" class="org.apache.activemq.pool.PooledConnectionFactory">
    <property name="connectionFactory">
      <amq:connectionFactory brokerURL="tcp://localhost:61616" />
    </property>
  </bean>

  <!--
  <amq:broker persistent="false">
    <amq:transportConnectors>
      <amq:transportConnector uri="tcp://localhost:61616" />
    </amq:transportConnectors>
  </amq:broker>
  -->


</beans>
